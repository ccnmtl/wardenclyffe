{% load waffle_tags %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Mediathread  &mdash; {% if audio %}Audio{% else %}Video{% endif %} Upload</title>
	<link rel="stylesheet" href="{{STATIC_URL}}css/main.css?v=1" media="screen" />
	<link rel="stylesheet" href="{{STATIC_URL}}css/print.css" media="print" />
	<!--[if IE 6]>
	<link rel="stylesheet" href="{{STATIC_URL}}css/main_ie6_1col.css" media="screen" />
	<![endif]-->
	<link rel="shortcut icon" href="{{STATIC_URL}}img/favicon.ico" type="image/x-icon" />

    {% include 'main/jquery.html' %}
    <script src="{{STATIC_URL}}js/jquery.query.js" type="text/javascript"></script>

    <script type="text/javascript" src="{{STATIC_URL}}js/swfobject.js"></script>
    <script src="{{STATIC_URL}}js/jquery.uploadify.min.js"></script>
    <link rel="stylesheet" href="{{STATIC_URL}}css/uploadify.css"></script>
</head>
<body class="one_column fixed mediathread">
    <div id="container">
        <!-- ###### Site banner ###### -->
        <div id="header">
        	<!-- Project title/logo --><h1 id="logo_project"></h1>	
        	<div id="mediathread_logo"><a href="#" onclick="window.location = jQuery.query.get('redirect_url').split('&')[0];"><img src="{{STATIC_URL}}img/logo_mediathread.png" width="172" height="42" /></a></div>
        </div><!-- id="header" -->

        <!-- ###### Don't touch this ###### -->
        <div class="visualclear"></div>

        <div id="content">
{% flag allow_uploads %}
            <h1>Mediathread {% if audio %}Audio{% else %}Video{% endif %} Upload</h1>

            <div id="admincontent" style="width: 600px;"> 
            	<div id="admincontent-inner"> 
            		<div id="admincontent-top"> 
                		<div id="admincontent-top-inner"> 
                			<div id="admincontent-top-body"></div> 
                		</div> 
            		</div> 
                    <div style="padding: 5px 15px 0 15px;">
                        <p>Welcome, <b>{% if user.first_name %}{{user.first_name}}
                        {{user.last_name}}{% else %}{{user.username}}{% endif %}</b>.</p>
                    {% if audio %}
                        <p>Use this form to upload audio. Mediathread supports audio files that end in <tt>.mp3</tt>. 
                        Any other audio should be converted to a mp3 before uploading.</p>
                    {% else %}
                        <p>Use this form to upload a video. Mediathread supports video files that end in .mov, .mp4, or .avi. 
                        Any other video should be converted to a Quicktime-compatible format before uploading. Submitted files must be less than 2GB.</p>
                    {% endif %}
                    </div>
            
                    <form action="post/" method="post" enctype="multipart/form-data">
{% if audio %}
  {% if audio2 %}
                    <input type="hidden" name="audio2" value="True" />
  {% else %}
                    <input type="hidden" name="audio" value="True" />
  {% endif %}
{% endif %}
                    <div id="vitaldropform" class="adminformcontainer">
                        <table border="0" cellpadding="0" cellspacing="0" id="adminformtable" class="adminformtable"> 
                        	<tr>
                                <td class="step one">
                                    <img src="{{STATIC_URL}}img/steps.png" alt="step one"></img>
                                </td>
                                <td class="step">
                                    <h4 id="upload_area">SELECT {% if audio %}audio{% else %}video{% endif %} file to upload {% if audio %}(.mp3){% else %}(.mov, .mp4, .avi){% endif %}</h4>
                                    <div>
                                    <input type="file" name="source_file" id="file_upload" />
                                    <input type="hidden" name="tmpfilename" id="tmpfilename" value="" />
                                    </div>
                                </td>
                            </tr>
                            <tr style="height: 30px"><td></td></tr>
                        
                        	<tr class="post-upload" style="display: none">
                                <td class="step two">
                                    <img src="{{STATIC_URL}}img/steps.png" alt="step two"></img>
                                </td>
                        	    <td class="step">
                                    <h4>UPDATE the {% if audio %}audio{% else %}video{% endif %} title</h4>
                                    <input type="text" name="title" value="Mediathread {% if audio %}audio{% else %}video{% endif %} uploaded by {{user.username}}" size="50" />
                                </td>
                        	</tr> 
                            <tr style="height: 30px"><td></td></tr>
                        	<tr class="post-upload" style="display: none">
                                <td class="step three">
                                    <img src="{{STATIC_URL}}img/steps.png" alt="step three"></img>
                                </td>
                                <td class="step three" colspan="2">
                                    <h4>UPLOAD the {% if audio %}audio{% else %}video{% endif %}</h4>
                        	        <input type="submit" value="Upload" class="regButton" id="submit" disabled="disabled" />
                        	   </td>
                            </tr> 
                        
                        
                        </table> 
                    
                    </div>
                    </form>
            
                    <hr />
                    <div style="padding: 5px 15px 0 15px;">
                      <p>if you encounter a problem converting or uploading a {% if audio %}audio{% else %}video{% endif %}, please visit CCNMTL's Helpdesk <a href="http://support.ccnmtl.columbia.edu/knowledgebase">http://support.ccnmtl.columbia.edu/knowledgebase</a></p>
                    </div>
            
            		<div id="admincontent-bottom"> 
            		<div id="admincontent-bottom-inner"> 
            			<div id="admincontent-bottom-body"></div> 
            		</div> 
            		</div> 
            	</div><!-- End id="admincontent-inner" --> 
            </div><!-- End id="admincontent" --> 

</div>
<br />
<br />
	<!-- ###### Footer ###### -->
	<div id="footer_m"><div></div>
{% else %}
{% include 'main/maintenance_mode.html' %}
{% endflag %}

</div>
    <script type="text/javascript">
        jQuery(document).ready(function() {
          
          jQuery('#file_upload').uploadify({
              'swf'  : '{{STATIC_URL}}swf/uploadify.swf',
              'uploader'    : '/uploadify/',
              'cancelImg' : '{{STATIC_URL}}img/pixel.gif',
              'folder'    : '/uploads',
              'auto'      : true,
              'fileTypeExts'   : {% if audio %}'*.mp3'{% else %}'*.mov;*.avi;*.mp4;*.mp3;*.m4v'{% endif %},
              'fileTypeDesc'  : '{% if audio %}Audio{% else %}Video{% endif %} Files',
              'removeCompleted' : false,
              'successTimeout': 3000,
              'buttonText' : 'Select File',
              'buttonClass': 'uploadify-button',
              'onUploadError' : function(file, errorCode, errorMsg, errorString) {
                 alert("There was an error uploading the file.\n" +
                       "This is usually a temporary issue.\n" +
                       "Please wait a minute or two and try again.");
              },
              'onUploadSuccess'  : function(file, data, response) {
                  if (response == "False") {
                     alert("upload failed. probably a bad network connection. please try again.");
				             return;
                  }
                  jQuery("#tmpfilename").val(data);
                  var elt = jQuery(".uploadifyQueueItem.completed span.percentage")[0];
                  jQuery(elt).html(" - Ready to upload");
                  jQuery("#submit").removeAttr("disabled");
                  jQuery("#file_uploadUploader").replaceWith();
                  jQuery(".post-upload").fadeIn();
              },
              'multi' : false
          });
        });
    </script>
</body>
