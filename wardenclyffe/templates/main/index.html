{% extends 'base.html' %}
{% load markup %}
{% block title %}Dashboard{% endblock %}
{% block pagetitle %}Dashboard{% endblock %}
{% block js %}

{{block.super}}

<script type="text/javascript">
$(document).ready(function() 
    { 
        $(".tablesorter").tablesorter({widgets: ['zebra']}); 
    } 
);
</script>

{% endblock %}

{% block jquery %}
<script>
jQuery(function($){
    $('.video_item .video_item_lead').click(function() {
      $(this).toggleClass("video_item_lead_open");
        $(this).next().slideToggle("fast");
    }).next().hide();
});
</script>
{% endblock %}


{% block content %}
<div class="row homepage">
    <div class="col-md-8">
        <a class="btn btn-sm btn-outline-dark float-right" href="/upload/">Add Video</a>
        <h3>Recent operations</h3>

        {% if videos %}
            <div id="accordion" role="tablist">
            {% for video in videos %}
                <div class="card">
                    <div class="card-header" role="tab">
                        <h6 class="mb-0">
                            <a data-toggle="collapse" href="#video-{{video.id}}" aria-expanded="false" aria-controls="video detail">
                            <span class="video_title">
                                {{video.title}}
                            </span>
                            in Collection
                            <span class="collection_title">
                                {{video.collection.title}}
                            </span>
                            created by
                            <span class="video_owner">
                            {{video.creator}}
                            </span>
                          </a>
                        </h6>
                    </div>
                    <div class="collapse" id="video-{{video.id}}">
                        <div class="row">
                            <div class="col-md-4 text-center">
                                <a href="{{video.get_absolute_url}}">{% with video.poster as poster %}
                                {% if poster.dummy %}
                                {% if video.is_audio_file %}
                                            <img src="{{STATIC_URL}}img/musicthumb160.jpg" width="160" height="120" />
                                {% else %}
                                            <img src="{{STATIC_URL}}img/vidthumb160.jpg" width="160" height="120" />
                                {% endif %}
                                {% else %}
                                <img src="{{poster.image.src}}" width="160"/>
                                {% endif %}
                                {% endwith %}</a>
                                <div class="video_url"><a href="{{video.get_absolute_url}}">Go to video</a></div>
                            </div>
                            <div class="col-md-8">
                                {% if video.operation_set.count %}
                                <table class="table table-striped table-bordered table-sm">
                                {% for operation in video.operation_set.all %}
                                    <tr>
                                    <td class="operation_status {{operation.status}}"></td>
                                    <td class="operation_action">{{operation.action}}</td><!--  class="operation_action" -->
                                    <td class="operation_date">{{operation.modified|date:"M d, Y"}} at {{operation.modified|date:"g:i A"}}</td><!-- class="operation_date" -->
                                    </tr>
                                {% endfor %}
                                </table>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>
        {% else %}
        <p style="padding: 10px; font-weight: bold;"><span style="color: #f00;">You have no videos.</span> <a href="/upload/">Add a new</a> video now.</p>
        {% endif %}
    </div>

    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <a class="btn btn-outline-dark btn-sm float-right" href="/add_collection/">add new</a>
                <h4 class="card-title">All Collections</h4>
                 <table>
                    <tbody>
                        {% for collection in collections %}
                        <tr class="{% cycle 'odd' 'even' %}">
                            <td><a href="{{collection.get_absolute_url}}">{{collection.title}}</a></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
             </div>
        </div>
    </div>
</div>
{% endblock %}
