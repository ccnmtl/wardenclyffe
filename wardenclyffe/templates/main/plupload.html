{% extends 'base.html' %}
{% load waffle_tags %}
{% load compress %}
{% block title %}{% if scan_directory %}Add Video from Drop-off Directory{% else %}Add Video from Desktop{% endif %}{% endblock %}
{% block pagetitle %}{% if scan_directory %}Add Video from Drop-off Directory{% else %}Add Video from Desktop{% endif %}{% endblock %}

{% block extra_head %}
{% compress js %}
<script src="{{STATIC_URL}}js/jquery.tagsinput.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/jquery.autocomplete.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/plupload.full.min.js"></script>
{% endcompress %}

{% compress css %}
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/jquery.tagsinput.css" />
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/jquery.autocomplete.css" />
{% endcompress %}

{% endblock %}

{% block content %}

{% flag allow_uploads %}
<form action="/upload/post/" method="post" enctype="multipart/form-data">

<div class="panel_top">
	<div class="form_video_source">
		<div class="form_video_source_title">Video source:</div>
{% if scan_directory %}
                <div class="wc_button inactive_button"><a href="/upload/" title="Upload files from your desktop">Desktop</a></div><!-- class="wc_button" -->
                <div class="wc_button active_button">Drop-off directory</div><!-- class="wc_button" -->
{% else %}
		<div class="wc_button active_button">Desktop</div><!-- class="wc_button" -->
		<div class="wc_button inactive_button"><a href="/scan_directory/" title="Upload files from the drop-off directory">Drop-off directory</a></div><!-- class="wc_button" -->
{% endif %}
		<div class="wc_help_button" id="help_video_source">?</div><!-- class="wc_help_button" -->
	</div><!-- class="form_video_source" -->

    <div class="form_video_collection">
        <div class="form_video_collection_title">
            <label for="id_collection">Collection:</label>
        </div>
        {% if form.collection %}
            {{ form.collection }}
        {% else %}
            {{ collection_title }}
        {% endif %}
    </div><!-- class="form_video_collection" -->

	<div class="visualclear"></div>
</div><!-- class="panel_top" -->

<div class="panel_middle">
	<div class="leftcol">
		<div class="sectionbox">
			<div class="fieldwrapper">
			<label for="id_title">Title:</label>
			{{ form.title }}
			</div>
		
			<div class="fieldwrapper">
			<label for="id_description">Description:</label>
			{{ form.description }}
			</div>
		
			<div class="fieldwrapper">
			<label for="id_subject">Subject(s):<div id="help_video_subject" class="wc_help_button floatright" style="margin-right: 18px;">?</div><!-- class="wc_help_button" --></label>
			{{ form.subject }}
			</div>

			<div class="fieldwrapper">
			<label for="id_tags">Tag(s):<div id="help_video_tag" class="wc_help_button floatright" style="margin-right: 18px;">?</div><!-- class="wc_help_button" --></label>
			{{ form.tags }}
			</div>

		</div><!-- class="sectionbox" -->
	</div><!--  class="leftcol" -->
	<div class="rightcol">
		<div class="sectionbox">
			<div class="section-header">
			Video file <div id="help_video_file" class="wc_help_button floatright" style="margin-right: 0px; margin-top: 5px;">?</div><!-- class="wc_help_button" -->
			</div>
			<input type="hidden" name="scan_directory"
			       value="{{scan_directory}}" />
{% if scan_directory %}			
       <div class="fieldwrapper inlinewrapper">
			 <label for="id_source_file">Upload:</label>
			 {% if file_listing %}
			 <select name="source_file" id="id_source_file"> 
			   <option value="" selected="selected">---------</option> 
			   {% for file in file_listing %}
			   <option value="{{file}}">{{file}}</option> 
			   {% endfor %}
			 </select> 
			 {% else %}
			 <p>There are no files in the drop-off directory</p>
			 {% endif %}
		       </div>
{% else %}
			<div class="fieldwrapper">
				<ul id="filelist"></ul>
				<a id="browse" href="javascript:;">Select File</a>
        <input type="hidden" name="tmpfilename" id="tmpfilename" value="" />

				<pre id="console"></pre>
			</div>

<script type="text/javascript">
</script>
{% endif %}
		
			<div class="fieldwrapper inlinewrapper">
			<label for="id_creator">Creator:</label>
			{{ form.creator }}
			</div>
		
			<div class="fieldwrapper inlinewrapper">
			<label for="id_language">Language:</label>
			{{ form.language }}
			</div>
		
			<div class="fieldwrapper inlinewrapper">
			<label for="id_license">License:</label>
			{{ form.license }}
			</div>
		
		</div><!-- class="sectionbox" -->
		<div class="sectionbox process_steps">
			<div class="section-header">
			Process steps <div id="help_process_steps" class="wc_help_button floatright" style="margin-right: 0px; margin-top: 5px;">?</div><!-- class="wc_help_button" -->
			</div>
			<div class="fieldwrapper">
				<input type="checkbox" name="submit_to_youtube" id="submit_to_youtube"/>Submit file to Youtube<br />
			</div>

			<div class="fieldwrapper disabled">
				<input type="checkbox" name="submit_to_mediathread" disabled="disabled" />Submit file to Mediathread<br />
			</div>


		</div><!-- class="sectionbox" -->


		<div class="sectionbox extra_fields ui-helper-hidden" id="extra_fields_box">
		  <div class="section-header">Extra Fields</div>
		</div>

	</div><!-- class="rightcol" -->
	<div class="visualclear"></div>
</div><!-- class="panel_middle" -->

<div class="panel_bottom">
	{% if collection_id %}
	<input type="hidden" name="collection" value="{{collection_id}}" />
	{% endif %}
	<input type="submit" id="submit" value="upload" class="regbutton
	floatleft" style="margin-left: 515px;" 
{% if scan_directory %}
{% else %}
 disabled="disabled"
{% endif %}
/>
	<div class="visualclear"></div>
</div><!-- class="panel_bottom" -->

		
</form>




{% include "flatpages/help_windows.html" %}





<script type="text/javascript">
jQuery(document).ready(function() 
    { 
    jQuery('#id_tags').tagsInput({
      autocomplete_url:'/api/tagautocomplete',
      defaultText: 'Add a tag...'
      }
     );
    jQuery('#id_subject').tagsInput({
      autocomplete_url:'/api/subjectautocomplete',
      defaultText: 'Add a subject...'
      }
     );
{% if scan_directory %}
{% else %}
var uploader = new plupload.Uploader({
  browse_button: 'browse', // this can be an id of a DOM element or the DOM element itself
  url: '/pluploadify/',
  max_retries: 3,
  multi_selection: false,
  runtimes : 'html5,flash,silverlight',
  flash_swf_url: '{{STATIC_URL}}js/Moxie.swf',
  silverlight_xap_url: '{{STATIC_URL}}js/Moxie.xap',
  filters: {
    mime_types : [
      { title : "Audio files", extensions : "mp3" },
      { title : "Video Files", extensions : "mov,avi,mp4,flv,mpg,wmv,m4v" }
    ]
  }
});

uploader.bind('FilesAdded', function(up, files) {
  var html = '';
  plupload.each(files, function(file) {
    html += '<li id="' + file.id + '">' + file.name + ' (' + plupload.formatSize(file.size) + ') <b></b></li>';
  });
  document.getElementById('filelist').innerHTML += html;

  // only allow one file at a time, and start uploading automatically
  $("#browse").replaceWith();
  up.start();
});

uploader.bind('UploadProgress', function(up, file) {
  document.getElementById(file.id).getElementsByTagName('b')[0].innerHTML = '<span>' + file.percent + "%</span>";
});

uploader.bind('Error', function(up, err) {
  console.log(err);
  document.getElementById('console').innerHTML += "\nError #" + err.code + ": " + err.message;
});

uploader.bind('FileUploaded', function(up, data, r) {
   console.log(r.response);
   $("#tmpfilename").val(r.response);
   $("#submit").removeAttr("disabled");
});

uploader.init();

{% endif %}
   }
);

</script>

<script src="{{STATIC_URL}}js/help_windows.js" type="text/javascript" language="javascript"></script>
{% else %}
{% include 'main/maintenance_mode.html' %}
{% endflag %}
{% endblock %}
<!--  -->
